version: '3.8'

services:
  # Webex Bot Service
  bot:
    build: .
    container_name: pipeline-notify-bot
    ports:
      - "${BOT_PORT:-5000}:5000"
    environment:
      - WEBEX_BOT_TOKEN=${WEBEX_BOT_TOKEN}
      - WEBEX_WEBHOOK_SECRET=${WEBEX_WEBHOOK_SECRET}
      - WEBEX_BOT_EMAIL=${WEBEX_BOT_EMAIL}
      - MCP_SERVER_URL=http://mcp-server:8080
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
    env_file:
      - .env
    depends_on:
      - mcp-server
    restart: unless-stopped
    networks:
      - pipeline-notify

  # MCP Orchestrator Service
  mcp-server:
    build: .
    container_name: pipeline-notify-mcp
    command: python -m mcp_server.server
    ports:
      - "${MCP_SERVER_PORT:-8080}:8080"
    environment:
      - JENKINS_BASE_URL=${JENKINS_BASE_URL}
      - JENKINS_USER=${JENKINS_USER}
      - JENKINS_API_TOKEN=${JENKINS_API_TOKEN}
      - SPLUNK_HOST=${SPLUNK_HOST}
      - SPLUNK_TOKEN=${SPLUNK_TOKEN}
      - SWARM_BASE_URL=${SWARM_BASE_URL}
      - SWARM_API_TOKEN=${SWARM_API_TOKEN}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - pipeline-notify

networks:
  pipeline-notify:
    driver: bridge
